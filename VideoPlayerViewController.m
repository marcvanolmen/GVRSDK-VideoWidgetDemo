#import <UIKit/UIKit.h>
#import <GoogleVR/GVRVideoView.h>

#import "VideoPlayerViewController.h"

////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////
@interface VideoPlayerViewController () <GVRVideoViewDelegate>

@property(nonatomic) IBOutlet GVRVideoView *videoView;
@property(nonatomic) BOOL isPaused;

@end

////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////
@implementation VideoPlayerViewController

////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////
- (void)viewDidLoad
{
    [super viewDidLoad];

    self.videoView.delegate = self;
    self.videoView.enableFullscreenButton = YES;
    self.videoView.enableCardboardButton = YES;

    self.isPaused = NO;

    NSURL *URL = [NSURL fileURLWithPath:[[NSBundle mainBundle] pathForResource:@"congo" ofType:@"mp4"]];
    [self.videoView loadFromUrl:URL];
}

////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////
- (void)viewDidDisappear:(BOOL)animated
{
    [super viewDidDisappear:animated];
    
    [self.videoView stop];
}

#pragma mark - GVRVideoViewDelegate

////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////
- (void)widgetViewDidTap:(GVRWidgetView *)widgetView
{
    if (self.isPaused) {
        [self.videoView resume];
    }
    else {
        [self.videoView pause];
    }
  
    self.isPaused = !self.isPaused;
}

////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////
- (void)widgetView:(GVRWidgetView *)widgetView didLoadContent:(id)content
{
    NSLog(@"Finished loading video");
}

////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////
- (void)widgetView:(GVRWidgetView *)widgetView didFailToLoadContent:(id)content withErrorMessage:(NSString *)errorMessage
{
    NSLog(@"Failed to load video: %@", errorMessage);
}

////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////
- (void)videoView:(GVRVideoView *)videoView didUpdatePosition:(NSTimeInterval)position
{
    // Loop the video when it reaches the end.
    if (position == videoView.duration) {
        [self.videoView seekTo:0];
        [self.videoView resume];
    }
}

////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////
- (IBAction)dismissMe:(UIButton *)sender
{
    self.videoView.delegate = nil;
    [self dismissViewControllerAnimated:YES completion:nil];
}

@end
